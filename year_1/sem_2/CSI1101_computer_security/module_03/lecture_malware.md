# Malware

## What is malware?

- **Mal**icious soft**ware**
- Software designed to infiltrate, damage or disrupt a computer system without the owner's informed consent

## Consequences of malware

- Malware may often
	- Steal personal information
	- Monitor your computer activity
	- Install additional software
	- Display forced advertising
	- Enable profiteering scams
	- Use your computer resources
		- CPU
		- RAM
		- etc

## What malware looks like

### To an IT professional

![malwarez](http://snag.gy/dHNH7.jpg)

>**Malwarez** is a series of visualization of worms, viruses, trojans and spyware code. For each piece of disassembled code, API calls, memory addresses and subroutines are tracked and analyzed. Their frequency, density and grouping are mapped to the inputs of an algorithm that grows a virtual 3D entity. The patterns and rhythms found in the data, influence the configuration of the articial organism.

>http://sq.ro/malwarez.htm

### To a home user

![homeuser](http://snag.gy/YdlMZ.jpg)

### Scare tactics

![warning](http://snag.gy/2bIMN.jpg)

## Evolution of malware

![evolution](http://snag.gy/H4BXi.jpg)

### Total malware

![total](http://snag.gy/j6fbf.jpg)

### New malware

![new](http://snag.gy/xsy66.jpg)

## When does a system become vulnerable to malware

- Flaws or bugs in software
- Over privileged users or system processes
- Design of software or a system
- Poorly implemented Standard Operating Environment practices
	- SOE

## Malware categories

- Viruses
- Trojans
- Worms
- Rootkit
- Botnets
- Logic bombs
- Spyware
- Scareware
- Ransomware

### Malware specimens

#### Zeus trojan horse

- Commonly spread by Facebook messages
- Installed via drive-by-downloads and phishing
- Windows only
- Attacker fine tunes their trojan to steal information of interest to them only

#### Psyb0t

- Targets Linux based ADSL routers
- Infection occurs from an internal IP address
- Initially pre-populated with 6000 usernames and 13000 passwords
- Generally exploits poorly configured devices
- When part of a botnet receives commands via IRC command and controls servers

## Classifying malware

- Malware can be classified into several categories, depending on their propagation, concealment and payload
	- Propagation
		- Human assisted
			- ie. Virus in email attachment
		- Automatic propagation
			- ie without human assistance
				- A worm
	- Concealment
		- Modifies OS to hide its existance
			- Rootkit
		- Provides desirable functionality
			- Trojan
	- Payload
		- Amusing/annoying prank
		- Destroy or corrupt files
		- Denial of Service attacks
		- Install backdoor/s
		- Alter web browser settings to display advertising

# Viruses

- A computer virus is a piece of software (code) that can infect other programs by modifying them
- A virus attaches itself to another program and secretly executes when the host program is executed
- A virus **will require** user assitance
	- Opening an email attachment
	- Sharing a USB drive

## Virus phases

- Dormant
	- Waiting on a trigger event
- Propagation
	- Replicating to programs/disk
- Triggering
	- By event to execute payload
- Execution
	- Of payload

### Dormant

- The virus is idle
- Will eventually be activated by some event, such as
	- Specific date
	- Presence of another program or file

### Propagation

- The virus places an identical copy of itself into other programs or into certain system areas on the disk
- Each infected program will now contain a clone of the virus
	- Which will itself enter a propagation phase

### Triggering

- The virus is activated to perform the function for which it was intended

### Execution

- The function of the virus is performed
	- May be harmless
		- A message on the screen
	- May be damaging
		- Destruction of programs and data files

## Virus structure

- Typically consists of three logical components
	1. Infection/replication mechanism
	2. Trigger
		- What will trigger the payload
	3. Payload
		- A malicious or benign outcome
- Not all viruses have an active payload
	- Some simply replicate for the sake of replicating

## Virus types

### File virus

- Infecting a highly used program will result in continuous re-infection and propagation
	- ie. Game or OS files

### Macro virus

- Macro language
- Infects files with macro code
- Commonly infects MS Office documents

### Boot sector virus

- Infects the code in the boot sector of hard disk

## Common virus injection techniques

![injection 1](http://snag.gy/ZB81r.jpg)

![injection 2](http://snag.gy/k6xLL.jpg)

>#### Append virus

>The virus attaches itself to the end of the host file and modifies the header of the host file so that the control shifts to it on execution. In an appending virus infection, the virus code is appended to the host program and the main entry point of the host program present in the program header is changed to point to the beginning of the virus code. So, when the program executes, the virus is executed first. Then at the end of the virus code, a jump or call routine takes the control back to the start of the host program. Also the new size of the infected host file is updated in the header accordingly.

>#### Prepend virus

>This is a type of virus that attaches itself to the start of the executable before the host file content. In a prepending virus infection, the virus code is inserted in the starting of the program immediately after the header. So when the program executes, the virus is executed first. Then the control reaches the end of the virus code and passes down into the host program code to execute the host program. The new size of the host file is updated in the header accordingly.

>#### Overwriting virus

>This is a type of virus that completely overwrites the entire host file that it attacks. The host file is lost and completely modified by the virus to add its code. In an overwriting virus infection, the virus code is overwritten over a portion or entire host program code. If the host file is larger than the virus program, the virus can either remove the whole host program code and replace it with a copy of its own code or overwrite the program code with its own code starting at the initial program code entry. So, when the host program is executed, the control is passed to the starting of the program code (that is overwritten by the virus code) and the virus gets executed. After the execution, the control passes to the remains of the host program code that will not make any sense as the initial part of the code is missing and the host program crashes. If the virus replaces the whole of the host program data segment and is larger than host program, the header needs to be modified to reflect the new size. If the virus replaces portion of the host program data segment, there will not be any change in the program size. These are the smallest (just a few bytes) and are mostly destructive.

>This type of virus completely overwrites the entire host file that it attacks. The host file is lost and completely modified by the virus to add its code. Once execution of the virus is complete the original program will not execute correct as essential code elements will no longer be present.


>#### Cavity virus

>In a cavity virus infection, the virus copies itself to one of the cavities present in the executable.The header of the original program is modified and control is passed directly to the virus. The file size remains unchanged as the virus occupies empty space in the code.

>#### Call Hooking / Entry Point Obfuscation virus

>This type of virus changes a random location in the host file data instead of the changing the headers or the initial host file data, so that the entry point of the virus is hidden in the host file safely.

## Virus concealment strategies

- Encrypted virus
	- Payload and replication mechanism is encrypted
	- Virus includes
		- Decryption engine
		- Encrypted body
	- Encryption remains the same throughout the life of the virus
- Stealth virus
	- Hides itself from AV detection
	- May copy data from non-infected files to itself to avoid detection
- Polymorphic virus
	- Changes appearance
	- Mutates with every infection
	- Changing encryption/decryption keys
	- Data appending / prepending
- Metamorphic virus
	- Mutates and rewrites itself with every iteration
	- Adding useless instructions and loops

# Worms

- A computer worm is a program that spreads without needing to insert itself into other files and usually without human interaction
- A worm will encompass a malicious payload such as
	- Deleting files
	- Creating backdoors
- Most worms spread by exploiting vulnerabilities or poorly configured systems

## Worm propagation

1. Scans for targets on network
2. Locate a target with vulnerability that could be exploited by worm
3. Exploit identified vulnerability and establishes itself on that host
4. Repeats the process by scanning for new targets that can be exploited

## Worm types

- Internet worms
	- Scans system for exploit
- Instant messaging
	- Uses contact lists to spread infected links
- IRC worms
	- Spread in channels by sending infected links or files to other IRC users
- File-sharing network worms
	- Are located in shared folders and spread to connected hosts

# Trojans

- A trojan (horse) is a program that appears to perform a useful task, but also performs a negative task
- Can be a resultant payload or its own program

## Trojan types

- Simple / classic trojan
	- A calculator program that looks and acts as a calculator, but every time the '7' button is pressed, it deletes a random file from the hard drive
- Remote access trojan
	- A backdoor into a system and allow an attacker to execute or monitor actions on the victim's computer
- Indirect trojan
	- Use infected computer to launch attacks

# Rootkits

- A stealth application designed to hide the fact that an operating system has been compromised
- Typically encompasses three components
	1. Concealment
	2. Command and control
	3. Surveillance

## Types of rootkits

### User-mode rootkits

- Run on infected device with admin/root access
- May alter/hide:
	- Security settings
	- Process
	- Files
	- System drives
	- Network ports
	- System services
- Can typically be removed with AV software but some damage to the system may be unrepairable

### Kernel-mode rootkits

- Kernel-mode rootkits run at the operating system level by adding to or changing critical system files
- Modify kernel data structures to return manipulated information to user applications
- System is infected via updates/patches
- Removing kernel-mode rootkits is extremely problematic

### Firmware rootkits

- Hides in firmware stored on flash memory
- Restarting/power cycling the infected device will result in re-contamination
- Removal of a firmware rootkit is temporary until the infected device is restarted
- May require an entire firmware update to be loaded resulting in data/settings loss

# Botnets

- Botnet is a collection of compromised computers
- Each compromised computer has software installed
	- Malware
- The *master* controls each of the computers over the Internet via installed malware
	- *Zombies*
- Malware can turn a host into a zombie
- A zombie is a machine controlled by a master

![botnet](http://snag.gy/ssoGG.jpg)

## Botnet trends

- Criminals are selling/buying botnets for personal use
	- Sending spam/phishing email
	- Launching Denial of Service attacks
	- Breaking crypto
	- Launching additional malware
- Investigations suggest that approximately 80% of spam originates from compromised home computers

# Logic bombs

- A logic bomb (usually) performs a malicious action as a result of a certain logic condition
- A programmer puts code into software for the payroll system that makes the program crash should it ever process two consecutive payrolls without paying him
- Some trial programs work for a certain period of time and then disable themselves

# Spyware

![spyware](http://snag.gy/suAm7.jpg)

# Adware

![adware](http://snag.gy/FFnAJ.jpg)

# Ransomware / Scareware

- Ransomware
	- Software that kidnaps a user's computer by encrypting a drive or files
	- Then demanding payment to decrypt it
- Scareware
	- Prompts tricking the user into download malicious software
	- Also known as fake anti-virus software

# Professional malware

- Growth in professional cybercrime and online fraud has led to demand in professionally developed cybercrime
- New malware is often custom designed to suit the needs / requirements of customer

# Malware countermeasures

## Anti-virus

### Signatures

- Each malware specimen has a unique set of instructions
- Instructions form the siganture or 'fingerprint'
- Anti-virus software uses a signature database to detect known malware
- A file is considered infected if it contains the known signature or unique instructions
- Sometimes false positives occur
	- A 'safe' file has instructions similar to a known virus file
- The vendors signature database is proprietary
- Demand for vendors detecting and releasing an updated database of signatures is high
- Until your anti-virus software database is updated you remain vulnerable

### Shield vs. On-demand

- Shield
	- Background processes
		- Daemon/service
	- Scans when a file is touched
		- Open
		- Copy
		- etc.
- On-demand
	- Scan on explicit user request according to regular schedule
	- Scan on suspicious
		- Files
		- Directory
		- Drive
		- etc.

### Online anti-virus software

- Free browser plugin
- No shielding
- Software/signatures updated before scan
- Each scan requires internet connectivity
- Report collected by vendor

### Offline anti-virus software

- Installed on the operating system
- System shielding
- User configurable
- Scan without internet connection
- Requires explicit user updates
- Paid or free annual subscription

### Quarantine

- Suspicious files can be placed into quarantine
- This is beneficial when you suspect a file, but are waiting for signature updates
- Whilst the file is in quarantine, it is harmless because it is encrypted
- Details of quarantine methods are proprietary and hence kept secret

### Fake AV software

- 2010-2011 fake AV software tricked users into installing malicious software
	- Damage to system was quick and apparent
- 2012 fake AV software still tricking users
	- Damage not apparent
	- Software portrays itself as being beneficial
	- Shows continuous virus removal
	- Fake AV expires and requests payment for its use

# Future of malware

- What will malware look like in the future
	- Mobile, ADSL routers, GPS?
	- Malware in embedded systems?
	- Smart TVs
- Any electronic device could be infected with malware
	- Implications for hospitals
	- How about planes?
- Cyber warfare
	- It is easier to hire a dozen hackers than it is to buy a dozen missiles
	- Will malware be the form of terrorism in the future?
- Robbing a bank with guns lacks class
	- Why not just use malware?

## Mobile malware

- Smart phone banking on the rise
- Smart phones/tablets replacing traditional computers
- Smart phones for two-factor authentication
